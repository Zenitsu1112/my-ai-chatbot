<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>AI Chat</title>
</head>
<body style="font-family: Arial; max-width: 400px; margin: 50px auto; padding: 20px;">
    
    <div id="login">
        <h2>AI Chat Login</h2>
        <input type="password" id="pwd" placeholder="Password" style="padding: 10px; width: 100%; margin: 10px 0;">
        <!-- CRITICAL: type="button" prevents form submission -->
        <button type="button" onclick="doLogin()" style="padding: 10px; width: 100%;">Login</button>
        <p id="err" style="color: red; display: none;">Wrong password</p>
    </div>
    
    <div id="chat" style="display: none;">
        <h2>Chat</h2>
        <div id="msgs" style="border: 1px solid #ccc; height: 300px; overflow-y: auto; padding: 10px; margin-bottom: 10px;"></div>
        <input type="text" id="msg" placeholder="Your message" style="padding: 10px; width: 70%;" onkeypress="if(event.key==='Enter')send()">
        <!-- CRITICAL: type="button" -->
        <button type="button" onclick="send()" style="padding: 10px; width: 28%;">Send</button>
    </div>

    <script>
        const API = 'https://my-ai-chatbot.zenitsu1112.workers.dev';
        let password = '';
        
        async function doLogin() {
            password = document.getElementById('pwd').value;
            document.getElementById('err').style.display = 'none';
            
            try {
                const res = await fetch(API, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({password: password, message: 'hi'})
                });
                
                if (!res.ok) throw new Error('bad');
                
                document.getElementById('login').style.display = 'none';
                document.getElementById('chat').style.display = 'block';
                addMsg('Bot', 'Connected!');
                
            } catch(e) {
                document.getElementById('err').style.display = 'block';
            }
        }
        
        async function send() {
            const input = document.getElementById('msg');
            const text = input.value.trim();
            if (!text) return;
            
            addMsg('You', text);
            input.value = '';
            
            const res = await fetch(API, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({password: password, message: text})
            });
            
            const data = await res.json();
            addMsg('Bot', data.reply || 'Error');
        }
        
        function addMsg(who, text) {
            const div = document.createElement('div');
            div.textContent = who + ': ' + text;
            div.style.margin = '5px 0';
            div.style.padding = '8px';
            div.style.background = who === 'You' ? '#667eea' : '#f0f0f0';
            div.style.color = who === 'You' ? 'white' : 'black';
            document.getElementById('msgs').appendChild(div);
        }
    </script>
</body>
</html>
